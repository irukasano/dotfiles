set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# --- Prefix をステータスラインに表示 ---
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# ネオングリーン系ステータス例（好みで）
# 見やすいネオングリーン系
set -g status on
set -g status-bg black
set -g status-fg colour82
# 非アクティブ
set -g window-status-format ' #[fg=colour242]#I #[fg=white]#W '
set -g window-status-separator ''
# アクティブを強烈に目立たせる
set -g window-status-current-format '#[bg=colour82,fg=black,bold] #I:#W #[default]'
# アクティブ/非アクティブの枠色
set -g pane-border-style 'fg=colour240'
set -g pane-active-border-style 'fg=colour82'
# 活動のあったウィンドウを点灯
setw -g monitor-activity on
set -g visual-activity on
set -g window-status-activity-style 'bg=colour22,fg=colour82,bold'
# 1始まりの連番に（数字で選びやすく）
set -g base-index 1
setw -g pane-base-index 1
# 左/右に prefix 状態を表示
set -g status-left  "#[bold]#S #[default]"
set -g status-right "#{prefix_highlight} %Y-%m-%d %H:%M "
set -g @prefix_highlight_show_copy_mode 'on'


# --- OSC52 経由でローカルクリップボードへコピー ---
set -g @plugin 'tmux-plugins/tmux-yank'
# 選択範囲をコピーしたら即ローカルの clipboard に送る
set -g @yank_selection 'clipboard'
set -g @yank_action 'copy-pipe-and-cancel'
# tmux 自体に clipboard 連携を許可
set -g set-clipboard on


# --- セッションを復帰する ---
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

# --- Ctrl-b F でウィンドウ/セッションをfuzzy検索（プラグインに同梱） ---
set -g @plugin 'sainnhe/tmux-fzf'

# --- スクロール体験を整える最小追記 ---
# 1) Copy-mode を常に「最下部」から開始（直前のvim残骸に飛ばない）
unbind [
bind [ copy-mode -e
# 2) 履歴を十分に確保（長い出力でも切れない）
set -g history-limit 50000
# 3) マウスで自然にスクロール（上スクロール→自動で copy-mode）
set -g mouse on
bind -n WheelUpPane   if-shell -F "#{pane_in_mode}" "send-keys -M" "copy-mode -e"
bind -n WheelDownPane if-shell -F "#{pane_in_mode}" "send-keys -M" "send-keys -M"
# 4) 「今からの出力だけ見たい」用：画面クリア＋スクロールバックも一掃
bind C-k send-keys C-l \; clear-history
# 5) （任意）vi 風の選択・コピー
# vi 風の選択・コピー（tmux はアクションに send -X が必要）
setw -g mode-keys vi
unbind -T copy-mode-vi v
unbind -T copy-mode-vi y
bind -T copy-mode-vi v     send -X begin-selection
bind -T copy-mode-vi V     send -X select-line
bind -T copy-mode-vi C-v   send -X rectangle-toggle
bind -T copy-mode-vi y     send -X copy-pipe-and-cancel "/usr/local/bin/osc52.sh"
bind -T copy-mode-vi Y     send -X copy-pipe-and-cancel "/usr/local/bin/osc52.sh"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "/usr/local/bin/osc52.sh"
bind -T copy-mode-vi Escape send -X cancel

run '~/.tmux/plugins/tpm/tpm'


# --- Overrides: vi copy to OSC52 ---
# Ensure yank in copy-mode-vi uses OSC52 after plugins load
unbind -T copy-mode-vi y
unbind -T copy-mode-vi Y
unbind -T copy-mode-vi Enter
bind -T copy-mode-vi y     send -X copy-pipe-and-cancel "/usr/local/bin/osc52.sh"
bind -T copy-mode-vi Y     send -X copy-pipe-and-cancel "/usr/local/bin/osc52.sh"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "/usr/local/bin/osc52.sh"

# --- Mouse selection to OSC52 ---
# Drag to select in copy-mode-vi; copy on release via OSC52
bind -T copy-mode-vi MouseDrag1Pane     send -X begin-selection
bind -T copy-mode-vi MouseDragEnd1Pane  send -X copy-pipe-and-cancel "/usr/local/bin/osc52.sh"
bind -T copy-mode-vi DoubleClick1Pane   send -X select-word
bind -T copy-mode-vi TripleClick1Pane   send -X select-line

# Auto-enter copy-mode on mouse drag, then start selection
bind -n MouseDown1Pane if -F "#{pane_in_mode}" \
  "send-keys -X begin-selection" \
  "copy-mode -e; send-keys -X begin-selection"
